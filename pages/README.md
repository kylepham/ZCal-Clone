https://blog.sycamore.design/material-ui-next-js-typescript

## Nextlog #02 - Mon, Jun 20, 2022

- What to install
  - `yarn add graphql @prisma/client @apollo/client apollo-server-micro micro micro-cors`
  - `yarn add -D prisma @types/micro-cors`
- Set up Prisma schemas
  - Run `npx prisma init`, this will create folder **`prisma/schema.prisma`** to write database schemas
    - Run `npx prisma db push` to create tables based on the schemas
    - Run `npx prisma db seed` to seed data to the database
- Set up GraphQL Apollo Server

  - The folder structure will be like this:

  ```bash
  graphql
  ┣ generated
  ┃ ┗ types.ts
  ┣ resolvers
  ┃ ┣ model
  ┃ ┃ ┣ InviteResolver.ts
  ┃ ┃ ┗ UserResolver.ts
  ┃ ┣ mutation
  ┃ ┃ ┣ CreateEventMutation.ts
  ┃ ┃ ┣ CreateInviteMutation.ts
  ┃ ┃ ┣ DeleteEventMutation.ts
  ┃ ┃ ┣ DeleteInviteMutation.ts
  ┃ ┃ ┗ UpdateInviteMutation.ts
  ┃ ┣ query
  ┃ ┃ ┣ InviteQuery.ts
  ┃ ┃ ┗ UserQuery.ts
  ┃ ┣ scalar
  ┃ ┃ ┗ IntervalsScalar.ts
  ┃ ┗ index.ts
  ┗ schema.graphql
  ```

  - Folder structure breakdowns:

    - **`generated`**: contains types that are generated by GraphQL Code Generator. See **[`codegen.yml`](./codegen.yml)** for configurations
    - **`resolvers/model`** contains resolvers for Models, those whose valued can be computed without storing in the Database
    - **`resolvers/mutation`** contains resolvers for all Mutations specified in **[`schema.graphql`](./graphql/schema.graphql)**
    - - **`resolvers/query`** contains resolvers for all Queries specified in **[`schema.graphql`](./graphql/schema.graphql)**
    - **`resolvers/scalar`** contains resolvers for all custom GraphQL Scalars specified in **[`schema.graphql`](./graphql/schema.graphql)**

  - Create **[`pages/api/graphql.ts`](./pages/api/graphql.ts)**:

  ```typescript
  import { ApolloServer } from "apollo-server-micro";
  import { MicroRequest } from "apollo-server-micro/dist/types";
  import { ServerResponse } from "http";
  import Cors from "micro-cors";
  import { PrismaClient } from "@prisma/client";
  import { readFileSync } from "fs";
  import { join } from "path";
  import { prisma } from "../../prisma";
  import resolvers from "../../graphql/resolvers";

  const cors = Cors();
  export type GraphQLContext = {
    prisma: PrismaClient;
  };

  export const createContext = () => {
    // expose the context to GraphQL queries and mutations
    return {
      prisma,
    };
  };

  const typeDefs = readFileSync(join(process.cwd(), "graphql", "schema.graphql"), "utf-8");
  const apolloServer = new ApolloServer({ typeDefs, resolvers, context: createContext() });
  const serverStart = apolloServer.start();

  export default cors(async (request: MicroRequest, response: ServerResponse) => {
    // Read more: https://github.com/apollographql/apollo-server/issues/2473
    if (request.method === "OPTIONS") {
      response.end();
      return;
    }

    await serverStart; // Apollo Server 3 Syntax
    await apolloServer.createHandler({
      path: "/api/graphql",
    })(request, response);
  });

  export const config = {
    api: {
      bodyParser: false,
    },
  };
  ```

- Important commands:

  - `yarn codegen`: to generate **[`types.ts`](./graphql/generated/types.ts)** file based on **[`codegen.yml`](./codegen.yml)** configurations
  - `yarn db:generate`: to generate types based on **[`schema.prisma`](./prisma/schema.prisma)**
  - `yarn db:push`: to push Prisma schemas to the DB
  - `pscale connect zcalclone`: connect to the cloud MySQL DB on [PlanetScale](https://planetscale.com/) and run it as a localhost instance

- ### REMEMBER TO ADD `DATABASE_URL` ENV VARIABLE GENERATED BY [PLANETSCALE](https://planetscale.com/) TO VERCEL DEPLOYMENT

## Nextlog #01 - Fri, May 27, 2022

- Build a login page
- Use **`next-auth`** to integrate Google OAuth Sign-in/Sign-out
  - Set up environment variable `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` (retrieved from the Google Cloud Console). Also set `NEXTAUTH_URL=http://localhost:3000`
  - Google Provider setup: [next-auth/google](https://next-auth.js.org/providers/google)
  - Use `useSession()` to access user data on client side
  - Use `getSession()` to access user data on server side
  - Fetch user data in `getServerSideProps` by passing `context` to `getSession()`
  - **Redirect to homepage** if the user is logged in on server side:
  ```typescript
  if (user) {
    res.setHeader("location", "/");
    res.statusCode = 302;
    res.end();
  }
  ```
  ### Update #1
  - For production, set `NEXTAUTH_URL=https://zcal.vercel.app/` (or any production url) to prevent not redirecting after logging in. **(WRONG URL WILL NOT RESULT IN REDIRECTION)**
